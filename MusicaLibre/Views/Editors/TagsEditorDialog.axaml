<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:MusicaLibre.ViewModels"
        xmlns:conv="clr-namespace:MusicaLibre.Converters"
        xmlns:ctrl="clr-namespace:MusicaLibre.Controls"
        xmlns:v="clr-namespace:MusicaLibre.Views"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="MusicaLibre.Views.TagsEditorDialog"
        Title="Edit Selection"
        Width="1800" Height="950"
        WindowStartupLocation="CenterOwner"
        x:DataType="vm:TagsEditorViewModel">
    
    <Window.Resources>
        <conv:NullToBooleanConverter x:Key="NullToBoolean"/>
        <conv:InverseBooleanConverter x:Key="InverseBoolean"/>
        <conv:BoolToUpdateTextConverter x:Key="MultipleUpdateWarning"></conv:BoolToUpdateTextConverter>
    </Window.Resources>
    
    <TabControl>
        <TabItem Header="Tracks">
            <Grid ColumnDefinitions="600, 6, *">
                <!-- Tracks list -->
                <Border BorderBrush="White" BorderThickness="1">
                    <Grid ColumnDefinitions="*">
                        <ctrl:TrackGrid 
                            ItemsSource="{Binding Items}"
                            Columns="{Binding Columns}"
                            SelectedItem="{Binding SelectedItem}" >
                            <ctrl:TrackGrid.Template>
                                <ControlTemplate>
                                    <ScrollViewer >
                                          <!--repeater-->
                                          <ItemsRepeater ItemsSource="{TemplateBinding ItemsSource}"  x:Name="PART_Repeater">
                                              <ItemsRepeater.Layout>
                                                  <StackLayout Orientation="Vertical"/>
                                              </ItemsRepeater.Layout>

                                              <ItemsRepeater.ItemTemplate>
                                                <DataTemplate DataType="vm:TrackViewModel">
                                                  <!-- row border-->
                                                  <Border Height="24" Margin="0 " Padding="0 0 16 0"
                                                          BorderBrush="DodgerBlue"  x:Name="PART_RowBorder"
                                                          Tag="{Binding IsSelected}"
                                                          PropertyChanged="TrackItemPropertyChanged">
                                                    <!-- row grid -->
                                                    <Grid VerticalAlignment="Center" x:Name="PART_RowGrid" Margin="10 0 0 0" />
                                                  </Border>
                                                </DataTemplate>
                                              </ItemsRepeater.ItemTemplate>
                                          </ItemsRepeater>
                                    </ScrollViewer>
                                </ControlTemplate>
                            </ctrl:TrackGrid.Template>
                        </ctrl:TrackGrid>
                    </Grid>
                </Border>
                <!--GridSplitter-->
                <GridSplitter Grid.Column="1" Width="6" Background="Transparent"/>
                <!-- Tags -->
                <Border Grid.Column="2"  BorderBrush="White" BorderThickness="1" Padding="16">
                    <Grid>
        <!--
                       immutable tab: path, codec, duration, bitrate, format, sample rate, channels
                       mutable tags :
                            multi-editable: title, album, discNumber, artists, conductor, remixer, composers, year, genres, publisher, comments
                                            Added, Created, Modified, Last Played  
                                            Artwork management
                                            
                            uni-editable: TrackNumber
                            album tab shows up if all selected tracks belong to the same album.
                            Should we do ID3vx editing in separate tabs ?
                       
        -->
                         <TabControl>
                             <TabItem Header="Track Info">
                                <ScrollViewer>
                                   <StackPanel>
                                       <Grid ColumnDefinitions="Auto, 32, *, 32" Margin="0 12">
                                           <TextBlock Grid.Column="0"
                                                      VerticalAlignment="Top"
                                                      Text="Path"/>
                                           <SelectableTextBlock Grid.Column="2" 
                                                                Text="{Binding FilePath}"
                                                                TextWrapping="Wrap"/>
                                       </Grid>
                                       <Grid ColumnDefinitions="*, Auto">
                                           <Grid ColumnDefinitions="Auto, 32, *, 32" 
                                                 RowDefinitions="Auto, Auto, Auto, Auto, Auto" >
                                               <!--File info-->
                                               <TextBlock Grid.Row="0" Grid.Column="0">Duration</TextBlock>
                                               <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding Duration}"/>
                                               
                                               <TextBlock Grid.Row="1" Grid.Column="0">Codec</TextBlock>
                                               <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding Codec}"/>
                                               
                                               <TextBlock Grid.Row="2" Grid.Column="0">Sample Rate</TextBlock>
                                               <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding SampleRate}"/>
                                               
                                               <TextBlock Grid.Row="3" Grid.Column="0">Channels</TextBlock>
                                               <TextBlock Grid.Row="3" Grid.Column="2" Text="{Binding Channels}"
                                                          Margin="0 0 0 16"/>
                                               
                                               <TextBlock Grid.Row="4"  Grid.Column="0" VerticalAlignment="Top" 
                                                          Margin="0 0 0 64" 
                                                           Text="Rating"/>
                                               <Slider  Grid.Row="4" Grid.Column="2"
                                                        IsVisible="{Binding IsMultiple, Converter={StaticResource InverseBoolean}}"
                                                        Minimum="0" Maximum="1"
                                                        Value="{Binding RatingBinding}"/>
                                               <TextBlock Grid.Row="4" Grid.Column="2"
                                                          IsVisible="{Binding IsMultiple}"
                                                          Text="Multiple Values"/>
                                           </Grid>
                                           
                                           <Grid Grid.Column="1" ColumnDefinitions="Auto, 32, 200, 32, 350" 
                                                 RowDefinitions=" Auto, Auto, Auto, 32, Auto" >
                                               <!-- Time Stamps-->
                                               <TextBlock Grid.Row="0" Grid.Column="0">Date Modified</TextBlock>
                                               <TextBox Grid.Row="0" Grid.Column="2" Text="{Binding ModifiedBinding}"/>
                                               <Button Grid.Row="0" Grid.Column="4" Content="Update" Command="{Binding UpdateModifiedCommand}"/>
                                               
                                               <TextBlock Grid.Row="1" Grid.Column="0">Date Created</TextBlock>
                                               <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding CreatedBinding}"/>
                                               <Button Grid.Row="1" Grid.Column="4" Content="Update" Command="{Binding UpdateCreatedCommand}"/>
                                               
                                               <TextBlock Grid.Row="2" Grid.Column="0">Date Added</TextBlock>
                                               <TextBox Grid.Row="2" Grid.Column="2"  Text="{Binding AddedBinding}"/>
                                               <Button Grid.Row="2" Grid.Column="4" Content="Update" Command="{Binding UpdateAddedCommand}"/>
                                               
                                               <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center">Last Played</TextBlock>
                                               <TextBlock Grid.Row="3" Grid.Column="2"  Text="{Binding PlayedBinding}"
                                                          VerticalAlignment="Center"/>  
                                               
                                               
                                           </Grid>
                                       </Grid>
                                       
                                       <Separator Height="1"/>
                                       <Grid ColumnDefinitions="Auto, 32, *">
                                           
                                       </Grid>
                                       
                                       <Separator Height="1"/>
                                       <TextBlock FontWeight="Bold" FontSize="16" Margin="16">Standard Tags</TextBlock>
                                       <Grid ColumnDefinitions="Auto, 32, *, 32, 200" 
                                             RowDefinitions="Auto, Auto, Auto, Auto, Auto, Auto, Auto, Auto, Auto, Auto, Auto, Auto, Auto">
                                           <!--Disc-->
                                           <TextBlock Grid.Row="0" Grid.Column="0">Disc Number</TextBlock>
                                           <TextBox Grid.Row="0" Grid.Column="2"  Text="{Binding DiscBinding}"/>   
                                           <Button Grid.Row="0" Grid.Column="4"
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"
                                                   Command="{Binding UpdateDiscNumberCommand}" />
                                           <!--Track-->
                                           <TextBlock Grid.Row="1" Grid.Column="0">Track Number</TextBlock>
                                           <TextBox  Grid.Row="1" Grid.Column="2" Text="{Binding TrackNumberBinding}"/>
                                           <Button Grid.Row="1" Grid.Column="4" 
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"
                                                   Command="{Binding UpdateTrackNumberCommand}"/>
                                           <!--Title-->
                                           <TextBlock Grid.Row="2" Grid.Column="0" >Title</TextBlock>
                                           <TextBox Grid.Row="2" Grid.Column="2" Text="{Binding TitleBinding}"/>
                                           <Button Grid.Row="2" Grid.Column="4" 
                                                   Command="{Binding TitleUpdatedCommand}"
                                                   Content="Update Selected Track"/>
                                           <!--Album-->
                                           <TextBlock Grid.Row="3" Grid.Column="0" >Album</TextBlock>
                                           <ctrl:TagBox Grid.Row="3" Grid.Column="2" IsMultiValue="False" 
                                                        Text="{Binding AlbumBinding}"
                                                        Options="{Binding AlbumOptions}"
                                                        EnterPressedCommand="{Binding AlbumUpdatedCommand}" />
                                           <Button Grid.Row="3" Grid.Column="4"
                                                   Command="{Binding AlbumUpdatedCommand}"
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           
                                           <!--AlbumArtist-->
                                           <TextBlock Grid.Row="4" Grid.Column="0" >Album Artist</TextBlock>
                                           
                                           <Grid Grid.Row="4" Grid.Column="2" ColumnDefinitions="*,16, Auto">
                                               <ctrl:TagBox Grid.Column="0" IsMultiValue="False" 
                                                            Text="{Binding AlbumArtistBinding}"
                                                            Options="{Binding ArtistsOptions}"
                                                            EnterPressedCommand="{Binding AlbumArtistUpdatedCommand}" />
                                               <Button  Grid.Column="2" 
                                                        Content="From track"
                                                        Command="{Binding AlbumArtistFromTrackCommand}"
                                                        ToolTip.Tip ="CopiedFrom Track Artist"/>
                                           </Grid>
                                           <Button Grid.Row="4" Grid.Column="4" 
                                                   Command="{Binding AlbumArtistUpdatedCommand}"
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           
                                           
                                           

                                           <!--Publisher-->
                                           <TextBlock Grid.Row="5" Grid.Column="0" >Publisher</TextBlock>
                                           <ctrl:TagBox Grid.Row="5" Grid.Column="2" IsMultiValue="False" 
                                                        Text="{Binding PublisherBinding}"
                                                        Options="{Binding PublisherOptions}"
                                                        EnterPressedCommand="{Binding PublisherUpdatedCommand}" />
                                           <Button Grid.Row="5" Grid.Column="4"
                                                   Command="{Binding PublisherUpdatedCommand}"
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           <!--Year-->
                                           <TextBlock Grid.Row="6" Grid.Column="0" >Year</TextBlock>
                                           <Grid   Grid.Row="6" Grid.Column="2"  ColumnDefinitions="150, 32, Auto, 64, *">
                                               <TextBox Grid.Column="0" Text="{Binding YearBinding}" />
                                               <Button Grid.Column="2"
                                                       Command ="{Binding YearUpdatedCommand}"
                                                       Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                               <StackPanel  Grid.Column="4" Orientation="Horizontal" HorizontalAlignment="Right">
                                                   <TextBlock VerticalAlignment="Center">Album Year :</TextBlock>
                                                   <TextBlock Text="{Binding CoalescedAlbumYear}" VerticalAlignment="Center"/>
                                                   <Border Width="32"></Border>
                                                   <Button Grid.Column="6" Content="Update Album Year" Command="{Binding UpdateAlbumYearCommand}"/>    
                                               </StackPanel>
                                           </Grid>
                                           
                                           <!--Artists-->
                                           <TextBlock Grid.Row="7" Grid.Column="0" >Artists</TextBlock>
                                           <ctrl:TagBox  Grid.Row="7" Grid.Column="2" 
                                                         Text="{Binding ArtistsBinding}"
                                                         Options="{Binding ArtistsOptions}"
                                                         IsMultiValue="True"
                                                         EnterPressedCommand="{Binding ArtistsUpdatedCommand}"/>
                                           <Button Grid.Row="7" Grid.Column="4" Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           <!--Genres-->
                                           <TextBlock Grid.Row="8" Grid.Column="0" >Genres</TextBlock>
                                           <ctrl:TagBox   Grid.Row="8" Grid.Column="2" 
                                                          Text="{Binding GenresBinding}"
                                                          Options="{Binding GenreOptions}"
                                                          IsMultiValue="True"
                                                          EnterPressedCommand="{Binding GenreUpdatedCommand}" />
                                           <Button Grid.Row="8" Grid.Column="4"
                                                   Command="{Binding GenreUpdatedCommand}"
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           <!--Composers-->
                                           <TextBlock Grid.Row="9" Grid.Column="0" >Composers</TextBlock>
                                           <TextBox  Grid.Row="9" Grid.Column="2" Text="{Binding ComposersBinding}"/>
                                           <Button Grid.Row="9" Grid.Column="4" Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           <!--Remixer-->
                                           <TextBlock Grid.Row="10" Grid.Column="0" >Remixer</TextBlock>
                                           <TextBox  Grid.Row="10" Grid.Column="2" Text="{Binding RemixerBinding}"/>
                                           <Button Grid.Row="10" Grid.Column="4" Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           <!--Conductor-->
                                           <TextBlock Grid.Row="11" Grid.Column="0" >Conductor</TextBlock>
                                           <TextBox  Grid.Row="11" Grid.Column="2" Text="{Binding ConductorBinding}"/>
                                           <Button Grid.Row="11" Grid.Column="4" Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"/>
                                           
                                           <!--Comments-->
                                           <TextBlock Grid.Row="12" Grid.Column="0" >Comments</TextBlock>
                                           <TextBox  Grid.Row="12" Grid.Column="2" Text="{Binding CommentsBinding}" Height="64"/>
                                           <Button Grid.Row="12" Grid.Column="4" 
                                                   Content="{Binding IsMultiple, Converter={StaticResource MultipleUpdateWarning}}"
                                                   Command="{Binding CommentsUpdatedCommand}"/>

                                       </Grid>
                                       <Button Content="Update Selected Files Metadata Tags" Command="{Binding UpdateFilesTagsCommand}"/>
                                   </StackPanel>    
                                </ScrollViewer>                                 
                             </TabItem>
                             <TabItem Header="Embedded Images">
                                 <v:ArtworkListManagerView DataContext="{Binding SelectedTrackArtwork}" />
                             </TabItem>
                         </TabControl>    
                               
                    </Grid>
                </Border>
            </Grid>
        </TabItem>
        <TabItem Header="Albums">
            <v:AlbumsEditorView DataContext="{Binding AlbumsEditor}"/>
        </TabItem>
        <TabItem Header="Artists"></TabItem>
        <TabItem Header="Genres">
           <v:GenresEditorView DataContext="{Binding GenresEditor}"/> 
        </TabItem>
        <TabItem Header="Publishers"></TabItem>
        <TabItem Header="Artworks"></TabItem>
    </TabControl>
</Window>
